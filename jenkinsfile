pipeline{
    agent any
    environment {
        IMGAE = "ll3lue/test"
        TAG = "test-build"
        DOCKERHUB_CREDENTIALS = credentials("ll3lue-dockerhub")
    }
    stages{
        stage("Init"){
            steps{
                echo "Init"
                echo "*****************************"
                sh "ls -la"
                echo "Init Completed."
            }
        }
        stage("Build"){
            steps{
                echo "Build"
                echo "*****************************"
                sh "docker build --no-cache -t $IMGAE:$TAG ."
                echo "Build Completed."
            }
        }
        stage("Login"){
            steps{
                sh "echo $DOCKERHUB_CREDENTIALS_PSW | docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin"
                echo "Login Successfully."
            }
        }
        stage("Push"){
            steps{
                sh "docker push $IMGAE:$TAG"
                echo "Push image to docker hub completed."
            }
        }
        post{
            always{
                sh "docker logout"
                echo "Logout Successfully."
            }
        }
    }
}